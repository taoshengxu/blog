<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>转录组分析笔记（2） - My Lives</title>
    <meta property="og:title" content="转录组分析笔记（2） - My Lives">
    

    
      
    

    

    
    


<link href='//cdn.bootcss.com/highlight.js/9.12.0/styles/github.min.css' rel='stylesheet' type='text/css' />



    <link rel="stylesheet" href="/blog/css/style.css" />
    <link rel="stylesheet" href="/blog/css/fonts.css" />
    <link rel="stylesheet" href="/blog/css/custom.css" />

  </head>

  
  <body class="blog">
    <header class="masthead">
      <h1><a href="/blog/">My Lives</a></h1>



      <nav class="menu">
        <input id="menu-check" type="checkbox" />
        <label id="menu-label" for="menu-check" class="unselectable">
          <span class="icon close-icon">✕</span>
          <span class="icon open-icon">☰</span>
          <span class="text">Menu</span>
        </label>
        <ul>
        
        
        <li><a href="/blog/">Home</a></li>
        
        <li><a href="/blog/en/">English</a></li>
        
        <li><a href="/blog/cn/">Chinese</a></li>
        
        <li><a href="/blog/travel/">Travel</a></li>
        
        
        </ul>
      </nav>
    </header>

    <article class="main">
      <header class="title">
      
<h1>转录组分析笔记（2）</h1>

<h3>
  2017-11-05</h3>
<hr>


      </header>





<p>这是一个生信技能树的优秀作业，一字未改。</p>

<p><a href="http://www.biotrainee.com/thread-1931-1-1.html">原文</a></p>

<h2 id="转录组差异表达分析小实战-一">转录组差异表达分析小实战（一）</h2>

<h5 id="读文献获取数据">读文献获取数据</h5>

<p>文献名称：AKAP95 regulates splicing through scaffolding
RNAs and RNA processing factors</p>

<ol>
<li><p>查找数据：Data availability<br />
The RIP-seq an RNA-seq data have been deposited in the Gene
Expression Omnibus database, with accession code GSE81916. All other data is
available from the author upon reasonable request.</p></li>

<li><p>获得GSE号：GSE81916</p></li>
</ol>

<h5 id="下载测序数据">下载测序数据</h5>

<ol>
<li><p><a href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE81916">https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE81916</a>获取数据信息，并点击网址下方的ftp，下载测序数据</p></li>

<li><p>从<a href="https://trace.ncbi.nlm.nih.gov/Traces/study/?acc=PRJNA323422">https://trace.ncbi.nlm.nih.gov/Traces/study/?acc=PRJNA323422</a>可知我们需要的mRNA测序编号为SRR3589956到SRR3589962</p></li>

<li><p>通过Apera下载SRR数据，这里以SRR3589956为例：</p>

<pre><code>ascp -T -i /home/anlan/.aspera/connect/etc/asperaweb_id_dsa.openssh anonftp@ftp-private.ncbi.nlm.nih.gov:sra/sra-instant/reads/ByRun/sra/SRR/SRR358/SRR3589956/SRR3589956.sra ./
</code></pre></li>
</ol>

<h5 id="转化fastq测序数据">转化fastq测序数据</h5>

<ol>
<li><p>通过sratoolkit工具将SRR文件转化为fastq格式的测序数据（写了个shell循环）</p>

<pre><code>for i in $(seq 56 62);do nohup fastq-dump --split-3  SRR35899${i} &amp;;done
</code></pre></li>

<li><p>通过fastqc对每个fastq文件进行质检，用multiqc查看整体质检报告（对当前目录下的fastq测序结果进行质检，生成每个fq文件的质检报告总multiqc整合后统计查看）</p>

<pre><code>fastqc *.fastq
multiqc ./
</code></pre>

<p>点击这个url可以查看我这个multiqc报告：<a href="http://www.bioinfo-scrounger.com/data/multiqc_report.html">http://www.bioinfo-scrounger.com/data/multiqc_report.html</a></p></li>

<li><p>如果有接头或者质量值不达标的需要进行过滤，这次的数据质量都不错，因此直接进行比对即可</p></li>
</ol>

<h5 id="序列比对">序列比对</h5>

<ol>
<li><p>安装hisat2软件，下载人类的hiast2索引文件</p>

<ul>
<li><p>hisat2下载并安装：</p>

<pre><code>ftp://ftp.ccb.jhu.edu/pub/infphilo/hisat2/downloads/hisat2-2.1.0-Linux_x86_64.zip
unzip hisat2-2.1.0-Linux_x86_64.zip
</code></pre></li>

<li><p>下载hisat2的human索引</p>

<pre><code>ftp://ftp.ccb.jhu.edu/pub/infphilo/hisat2/data/hg19.tar.gz
tar zxvf hg19.tar.gz
</code></pre></li>
</ul></li>

<li><p>用hisat2进行比对，测序数据放在data目录下，索引文件放在reference/index/hisat2/hg19目录下，SRR3589956-SRR3589958为人的测序数据</p>

<pre><code>for i in $(seq 56 58);do hisat2 -p 4 \
-x ~/reference/index/hisat2/hg19/genome \
-1 ./data/SRR35899${i}_1.fastq -2 ./data/SRR35899${i}_2.fastq \
-S SRR35899$i.sam &gt;SRR35899${i}.log;done
</code></pre></li>

<li><p>用samtools将sam文件转化为bam文件，并使用默认排序</p>

<pre><code>for i in $(seq 56 58);do samtools sort -@ 5 -o SRR35899${i}.bam SRR35899${i}.sam;done
</code></pre></li>
</ol>

<h5 id="reads计数">reads计数</h5>

<ol>
<li><p>用htseq对比对产生的bam进行count计数</p>

<ul>
<li><p>htseq安装，使用miniconda，省事！唯一的问题是htseq版本不是最新的，是0.7.2。想要最新版还是要正常安装，可参考<a href="http://www.biotrainee.com/thread-1847-1-2.html">http://www.biotrainee.com/thread-1847-1-2.html</a></p>

<pre><code>conda install -c bioconda htseq
</code></pre></li>

<li><p>用htseq将对比后的结果进行计数</p>

<pre><code>for i in $(seq 56 58);do htseq-count -f bam -r pos -s no \
SRR35899${i}.bam ~/reference/genome/hg19/gencode.v26lift37.annotation.gtf \
1&gt;SRR35899${i}.count 2&gt;SRR35899${i}_htseq.log;done
</code></pre></li>
</ul></li>

<li><p>将3个count文件（SRR3589956.count，SRR3589957.count，SRR3589958.count）合并成一个count矩阵，这是就需要脚本来解决这个问题，不然其他方法会稍微麻烦点</p>

<pre><code>#!/usr/bin/perl -w
use strict;

my $path = shift @ARGV;
opendir DIR, $path or die;
my @dir = readdir DIR;

my $header;
my @sample;
my %hash;
foreach my $file (@dir) {
    if ($file =~ /^\w+.*\.count/) {
        push @sample, $file;
        $header .= &quot;\t$file&quot;;
        open my $fh, $file or die;
        while (&lt;$fh&gt;) {
            chomp;
            next if ($_ =~ /^\W+/);
            my @array = split /\t/, $_;
            $hash{$array[0]} -&gt; {$file} = $array[1];
        }
        close $fh;
    }
}
print &quot;$header\n&quot;;
map{
    my $gene = $_;
    print &quot;$gene&quot;;
    foreach my $file (@sample) {
        print &quot;\t&quot;.$hash{$gene} -&gt; {$file};
    }
    print &quot;\n&quot;;
}keys %hash;
</code></pre></li>

<li><p>按照接下来的剧本，应该讲count<em>matrix文件导入DESeq进行差异表达分析。但是从这篇文章的Bioinformatic analyses部分可以发现，作者的control组的2组数据是来自2个不同的批次（一个是SRR3589956，另外一个来源GSM1095127 in GSE44976），treat组倒是同一个批次（SRR3589957和SRR3589958）。但是对于Mouse cells来说，倒是满足2个control和2个treat都正常来自同个批次，因此打算重新用SRR3589959-SRR3589962重新做个一个count</em>matrix进行后续差异分析</p></li>
</ol>


  <footer>
  
<nav class="post-nav">
  <span class="nav-prev">&larr; <a href="/blog/cn/2017/11/transcriptome_analysis/">转录组分析笔记</a></span>
  <span class="nav-next"><a href="/blog/cn/2017/11/python_study/">python学习</a> &rarr;</span>
</nav>





<script src="//yihui.name/js/math-code.js"></script>
<script async src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>

<script async src="//yihui.name/js/center-img.js"></script>

  



<script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>



<script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/r.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/yaml.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/tex.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>



  
  <hr>
  <div class="copyright">&copy; <a href="xxxx">Who care</a> 2017 - Forever, maybe</div>
  
  </footer>
  </article>
  
  </body>
</html>

