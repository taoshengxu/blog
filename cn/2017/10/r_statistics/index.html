<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>R统计分析  - My Lives</title>
    <meta property="og:title" content="R统计分析  - My Lives">
    

    
      
    

    

    
    


<link href='//cdn.bootcss.com/highlight.js/9.12.0/styles/github.min.css' rel='stylesheet' type='text/css' />



    <link rel="stylesheet" href="/blog/css/style.css" />
    <link rel="stylesheet" href="/blog/css/fonts.css" />
    <link rel="stylesheet" href="/blog/css/custom.css" />

  </head>

  
  <body class="blog">
    <header class="masthead">
      <h1><a href="/blog/">My Lives</a></h1>



      <nav class="menu">
        <input id="menu-check" type="checkbox" />
        <label id="menu-label" for="menu-check" class="unselectable">
          <span class="icon close-icon">✕</span>
          <span class="icon open-icon">☰</span>
          <span class="text">Menu</span>
        </label>
        <ul>
        
        
        <li><a href="/blog/">Home</a></li>
        
        <li><a href="/blog/en/">English</a></li>
        
        <li><a href="/blog/cn/">Chinese</a></li>
        
        <li><a href="/blog/travel/">Travel</a></li>
        
        
        </ul>
      </nav>
    </header>

    <article class="main">
      <header class="title">
      
<h1>R统计分析 </h1>

<h3>
  2017-10-13</h3>
<hr>


      </header>





<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

<h1 id="概率分布">概率分布</h1>

<p><img src="https://taoshengxu.github.io/DocumentGit/img/R_probility.jpg" alt="" /></p>

<h1 id="样本抽样">样本抽样</h1>

<h4 id="1-简单随机抽样">1. 简单随机抽样</h4>

<pre><code>sample(x,size,replace=FALSE,
       prob #数据被抽取的权重值)
</code></pre>

<h4 id="2-按权重的样本抽样">2. 按权重的样本抽样</h4>

<pre><code>sample(1:10,5,replace=TRUE,prob=1:10)
</code></pre>

<h4 id="3-分层随机抽样">3. 分层随机抽样</h4>

<p>例如：男性占20%，女性占80%，如果通过抽样来统计组群的平均身高，性别不同会对统计结果有直接影响，因此可以根据男女性别比例采用分层抽样。</p>

<p>分层抽样的好处是可以根据每层分别抽样不同数量的样本</p>

<pre><code>strata(data, stratanames=NULL, size, method=c(&quot;srswor&quot;,&quot;srswr&quot;,&quot;poisson&quot;,
&quot;systematic&quot;), pik,description=FALSE)
</code></pre>

<pre><code>library(&quot;sampling&quot;)
x= strata(data=iris,c(&quot;Species&quot;),size=c(3,3,5),method=&quot;srswor&quot;)
getdata(iris,x)
</code></pre>

<h4 id="4-系统抽样">4. 系统抽样</h4>

<p>例如：要对从全天经过某一路口的车辆号牌进行抽样调查，如果采用简单随机抽样，早、晚高峰的经过的车辆会被过多抽取。</p>

<p><strong>系统抽样：</strong>将样本总体从1~N编号，然后随机确定抽样起点，以固定间隔k=N/n进行等间隔抽样。因此如果整体数据呈现有序排列形式，系统抽样会获得更好的结果，但是周期数据将会导致偏向性。</p>

<pre><code>library(&quot;doBy&quot;)
sampleBy(~1,frac=.3,data=x,systematic=TRUE)
</code></pre>

<h1 id="列联表">列联表</h1>

<p><strong>列联表：</strong>以表格形式记录分类变量的频数。卡方独立性检验考察变量之间是否存在依存关系。</p>

<table>
<thead>
<tr>
<th>&ndash;</th>
<th>预测-垃圾邮件</th>
<th>预测-非垃圾邮件</th>
</tr>
</thead>

<tbody>
<tr>
<td>实际-垃圾邮件</td>
<td>a</td>
<td>b</td>
</tr>

<tr>
<td>实际-非垃圾邮件</td>
<td>c</td>
<td>d</td>
</tr>
</tbody>
</table>

<h4 id="创建列联表">创建列联表</h4>

<pre><code class="language-r">d=data.frame(x=c(&quot;1&quot;,&quot;2&quot;,&quot;2&quot;,&quot;1&quot;)),
             y=c(&quot;A&quot;,&quot;B&quot;,&quot;A&quot;,&quot;B&quot;),
             num=c(3,5,8,7)
xt=xtabs(num ~ x + y,data=d)

##边际量
margin.table(xt) 
margin.table(xt,1)#行
margin.table(xt,2)#列
##边际百分比
prop.table(xt)
prop.table(xt,1)#行
prop.table(xt,2)#列
</code></pre>

<h1 id="独立性检验">独立性检验</h1>

<table>
<thead>
<tr>
<th>&ndash;</th>
<th>A-TRUE</th>
<th>A-FALSE</th>
</tr>
</thead>

<tbody>
<tr>
<td>B-TURE</td>
<td>a</td>
<td>b</td>
</tr>

<tr>
<td>B-FALSE</td>
<td>c</td>
<td>d</td>
</tr>
</tbody>
</table>

<p>假设A 与 B 独立，则P(AB)=P(A)*P(B).</p>

<p><strong>1. 卡方检验</strong></p>

<p>对两个变量的独立性进行检验，统计量如下：</p>

<p>$$\sum_{i=1}^{r}\sum_{j=1}^{c}\frac{(O_{ij}-E_{ij})^2}{E_{ij}} \backsim {\chi}^2(r-1)(c-1)$$</p>

<p>其中，\(O_{ij}\)为列联表中（i,j）的记录值，\(E_{ij}=N * P(i)* P(j)\)为两变量相互独立时单元的期望值。</p>

<pre><code class="language-r">library(&quot;MASS&quot;)
data(survey)
xtabs(~Sex + Exer,data=survey)##性别和运动的列联表
##              Exer
##Sex      Freq None Some
##Female   49   11   58
##Male     65   13   40

chisq.test(xtabs(~Sex + Exer,data=survey))
##  Pearson's Chi-squared test
##data:  xtabs(~Sex + Exer, data = survey)
##X-squared = 5.7184, df = 2, p-value = 0.05731
</code></pre>

<p>结果：p值不具有显著性，因此不能推翻原假设H0（性别与运动独立），接受H0(原假设不是小概率事件).</p>

<p><img src="https://taoshengxu.github.io/DocumentGit/img/pvalue1.jpg" alt="" />
<img src="https://taoshengxu.github.io/DocumentGit/img/pvalue2.jpg" alt="" />
<img src="https://taoshengxu.github.io/DocumentGit/img/pvalue3.jpg" alt="" /></p>

<p><strong>2. Fisher检验</strong></p>

<p>针对列联表中样本数量较少，或者样本分布过分倾向某个单元，卡方检验的结果可能不准确。chisq.test()进行检验会显示警告信息。</p>

<pre><code class="language-r">xtabs(~W.Hnd + Clap,data=survey)
##       Clap
##W.Hnd   Left Neither Right
##Left     9       5     4
##Right   29      45   143
chisq.test(xtabs(~W.Hnd + Clap,data=survey))
##  Pearson's Chi-squared test
##data:  xtabs(~W.Hnd + Clap, data = survey)
##X-squared = 19.252, df = 2, p-value = 6.598e-05

##Warning message:
##In chisq.test(xtabs(~W.Hnd + Clap, data = survey)) :
##  Chi-squared近似算法有可能不准

fisher.test(xtabs(~W.Hnd + Clap,data=survey))
##  Fisher's Exact Test for Count Data

##data:  xtabs(~W.Hnd + Clap, data = survey)
##p-value = 0.0001413
##alternative hypothesis: two.sided
</code></pre>

<p>结果：显示P值具有显著性，推翻原假设【用于写字的手与鼓掌时放在上面的手独立】（原假设为小概率事件），接受两者之间有关系。</p>

<p><strong>3. McNemar检验</strong></p>

<p>McNemar检验检验事件发生前后被调查者的反应变化，比如推行罚款政策后系安全带人数的变化。在事件之前进行问卷调查Test1,事件发生之后问卷调查Test2.</p>

<table>
<thead>
<tr>
<th>&ndash;</th>
<th>Test 2-TRUE</th>
<th>Test 2-FALSE</th>
</tr>
</thead>

<tbody>
<tr>
<td>Test 1</td>
<td>a</td>
<td>b</td>
</tr>

<tr>
<td>Test 1</td>
<td>c</td>
<td>d</td>
</tr>
</tbody>
</table>

<p>假设事件发生前后参与调查的人数未发生变化，a+b=a+c。只要检验b=c是否成立，即可知道事件发生前后人们心理趋向是否发生变化。若b=c成立，则b服从二项分布。</p>

<p>$$b \backsim B(b+c,\frac{1}{2})$$</p>

<p>二项分布B(n,p)中当n (列联表中b+c)较大时，可以近视视作正态分布。</p>

<p>$$b \backsim N(\frac{b+c}{2},\frac{b+c}{4})$$</p>

<p>将b标准化，使之服从N(0,1),并用连续校正，得到</p>

<p>$$\frac{(|b-c|-1)^2}{b+c} \backsim \chi^2(1)$$</p>

<pre><code>performance=matrix(c(794,86,150,570),nrow=2,dimnames=list(
                          &quot;1st survey&quot;=c(&quot;Approve&quot;,&quot;Disapprove&quot;),
                          &quot;2st survey&quot;=c(&quot;Approve&quot;,&quot;Disapprove&quot;)))
                          
mcnemar.test(performance)

##  McNemar's Chi-squared test with continuity correction
##data:  performance
##McNemar's chi-squared = 16.818, df = 1, p-value = 4.115e-05
</code></pre>

<p>结果：P值结果具有显著性，原假设为小概率事件，推翻原假设，事件发生前后，&rdquo;Approve&rdquo;和&rdquo;Disapprove&rdquo;比率发生变化。</p>

<h1 id="拟合优度检验">拟合优度检验</h1>

<p>统计分析中，常常假设数据服从某种分布，特别是数据量超过一定数值时，一般假设数据服从正态分布。</p>

<p><strong>1. 卡方检验</strong></p>

<p>为了验证数据是否服从某种特定分布，通常先要创建列联表。</p>

<p>例如：分析用左手写字的人数与用右手写字的人数比率是否为30%：70%。</p>

<pre><code>library(&quot;MASS&quot;)
data(survey)
table(survey$W.Hnd)
chisq.test(table(survey$W.Hnd),p=c(0.3,0.7))

#Chi-squared test for given probabilities
#data:  table(survey$W.Hnd)
#X-squared = 56.252, df = 1, p-value = 6.376e-14
</code></pre>

<p>结果：p值显著，原假设为小概率事件，拒绝原假设，左手写字的人数与用右手写字的人数比率为30%：70%不成立。</p>

<p><strong>2. Shapiro-Wilk（夏皮罗-威尔克）检验</strong></p>

<p><strong>Shapiro-Wilk用于检验样本是否来源于正态分布的总体</strong>（样本是否从正态分布的数据中抽取的）。</p>

<pre><code> shapiro.test(rnorm(1000))
##  Shapiro-Wilk normality test
##data:  rnorm(1000)
##W = 0.99883, p-value = 0.7749
</code></pre>

<p>结果：p值不显著，原假设不为小概率事件，接受原假设，肯定样本来源于正态分布整体。</p>

<p><strong>3. Kolmogorov-smirnov test（柯尔莫哥-斯米诺夫 K-S）检验</strong></p>

<p>将数据的累积分布函数与要比较的分布的累积分布函数之间的<strong>最大距离</strong>作为统计量。</p>

<p><img src="https://taoshengxu.github.io/DocumentGit/img/KS_test.jpg" alt="" /></p>

<p>例如： 检验两组正态分布的随机数据之间是否拥有相同的分布。</p>

<pre><code>ks.test(rnorm(100),rnorm(100))

#   Two-sample Kolmogorov-Smirnov test
#data:  rnorm(100) and rnorm(100)
#D = 0.1, p-value = 0.6994
#alternative hypothesis: two-sided
##p值不显著，原假设不为小概率事件，接受原假设，两组样本具有相同分布。

ks.test(rnorm(100),runif(100))
#   Two-sample Kolmogorov-Smirnov test
#data:  rnorm(100) and runif(100)
#D = 0.54, p-value = 4.335e-13
#alternative hypothesis: two-sided
##p值显著，原假设为小概率事件，拒绝原假设，两组样本不具有相同分布。
</code></pre>

<p><strong>4. Q-Q（Quantile-Quantile）图</strong></p>

<p><strong>Q-Q图</strong>是一种检验数据是否服从某种特定分布的可视化方法。</p>

<p>例如：要检验X是否服从正态分布。若\(X \backsim N(\mu,\delta^2)\),则</p>

<p>$$Z=\frac{X-\mu}{\delta} \backsim N(0,1)$$</p>

<p>$$X=\mu + \delta Z$$</p>

<p>若将(X,Z)绘制到坐标平面，则为一条直线。X是待检验的已知数据，Z为标准正态分布数据，因此找到与X对应的Z即可，可以通过分位数完成。</p>

<pre><code>x=rnorm(1000,mean=10,sd=1)
qqnorm(x)
qqline(x,lty=2)
</code></pre>

<p><img src="https://taoshengxu.github.io/DocumentGit/img/Q-Qplot1.jpeg" alt="" /></p>

<pre><code>x=runif(1000)
qqnorm(x)
qqline(x,lty=2)
</code></pre>

<h1 id="相关分析">相关分析</h1>

<p><strong>1.Pearson（皮尔逊）相关系数</strong></p>

<p><img src="https://taoshengxu.github.io/DocumentGit/Pearsoncorrelation.gif" alt="" /></p>

<p>当两个变量的标准差都不为零时，相关系数才有定义，皮尔逊相关系数适用于：</p>

<ol>
<li>两个变量之间是线性关系，都是连续数据。</li>
<li>两个变量的总体是正态分布，或接近正态的单峰分布。</li>
<li>两个变量的观测值是成对的，每对观测值之间相互独立。</li>
</ol>

<p><strong>2.Spearman Rank(斯皮尔曼等级)相关系数</strong></p>

<p>斯皮尔曼等级相关系数用来估计两个变量X、Y之间的相关性，其中变量间的相关性可以使用单调函数来描述。如果两个变量取值的两个集合中均不存在相同的两个元素，那么，当其中一个变量可以表示为另一个变量的很好的单调函数时（即两个变量的变化趋势相同），两个变量之间的ρ可以达到+1或-1。</p>

<p>假设两个随机变量分别为X、Y（也可以看做两个集合），它们的元素个数均为N，两个随机变量取的第i（1&lt;=i&lt;=N）个值分别用Xi、Yi表示。对X、Y进行排序（同时为升序或降序），得到两个元素排行集合x、y，其中元素xi、yi分别为Xi在X中的排行以及Yi在Y中的排行。将集合x、y中的元素对应相减得到一个排行差分集合d，其中di=xi-yi，1&lt;=i&lt;=N。随机变量X、Y之间的斯皮尔曼等级相关系数可以由x、y或者d计算得到，其计算方式如下所示：</p>

<p><img src="https://taoshengxu.github.io/DocumentGit/img/SpearmanRank1.gif" alt="" /></p>

<p><img src="https://taoshengxu.github.io/DocumentGit/img/SpearmanRank2.gif" alt="" /></p>

<p><strong>3.Kendall Rank（肯德尔等级）相关系数</strong></p>

<p>xxx</p>

<p><strong>4.相关系数检验</strong></p>

<p>*原假设：相关系数为0</p>

<p>*备选假设： 相关系数不为0.</p>

<pre><code class="language-r">cor(iris$Sepal.Width,iris$Sepal.Length)
cor(iris[,1:4])
library(corrgram)#可视化显示相关系数
corrgram(iris,upper.panel=panel.conf)

m=matrix(c(1:10),(1:10)^2),ncol=2))
cor(m,method=&quot;spearman&quot;)

cor.test(c(1,2,3,4,5),c(1,0,3,4,5),method=&quot;pearson&quot;)
cor.test(c(1,2,3,4,5),c(1,0,3,4,5),method=&quot;spearman&quot;)
cor.test(c(1,2,3,4,5),c(1,0,3,4,5),method=&quot;kendall&quot;)
</code></pre>

<h1 id="估计与检验">估计与检验</h1>

<p><strong>1.单样本均值</strong></p>

<p>$$\frac{\overline{X}-\mu}{S/\sqrt{n}} \backsim t(n-1)$$</p>

<p>显著性水平为a时，关于整体均值的95%置信水平的置信区间为：</p>

<p>$$(\overline{X} - t(n-1;\alpha/2) * S/\sqrt{n},\overline{X} + t(n-1;\alpha/2) * S/\sqrt{n}$$</p>

<p><img src="https://taoshengxu.github.io/DocumentGit/img/t_test.jpg" alt="" /></p>

<p><strong>零假设</strong>：整体均值为mu.</p>

<pre><code>x=rnorm(30)
t.test(x)
t.test(x,mu=0)
##  One Sample t-test
##data:  x
##t = 0.052695, df = 29, p-value = 0.9583
##alternative hypothesis: true mean is not equal to 0
##95 percent confidence interval:
## -0.3502195  0.3687436
##sample estimates:
##  mean of x 
##0.009262058 

y=rnorm(30,mean=10)
t.test(y)
t.test(y,mu=10)

</code></pre>

<p>结果： 推断整体均值为0.009262058，总体均值95%置信区间为（-0.3502195,  0.3687436）。p值不显著，不能拒绝0假设，总体均值可以被视为0，0也在95%置信区间内。</p>

<p><strong>2.两独立样本均值</strong></p>

<p>从两个总体分别抽取样本，根据样本推断两个整体均值是否一致。</p>

<p><img src="https://taoshengxu.github.io/DocumentGit/img/twosample_test1.jpg" alt="" />
<img src="https://taoshengxu.github.io/DocumentGit/img/twosample_test2.jpg" alt="" /></p>

<pre><code class="language-r">sleep2=sleep[,-3]
tapply(sleep2$extra,sleep2$group,mean)
var.test(extra ~ group,data = sleep2)##首先检验两组样本方差是否一致

##F test to compare two variances
##data:  extra by group
##F = 0.79834, num df = 9, denom df = 9, p-value = 0.7427
##alternative hypothesis: true ratio of variances is not equal to 1
##95 percent confidence interval:
##  0.198297 3.214123
##sample estimates:
##  ratio of variances 
##0.7983426 
## 原假设：两者方差无差别。因此不能拒绝原假设。

t.test(extra ~ group,data = sleep2,paired=FALSE,var.equal=TRUE)
##Two Sample t-test
##data:  extra by group
##t = -1.8608, df = 18, p-value = 0.07919
##alternative hypothesis: true difference in means is not equal to 0
##95 percent confidence interval:
##  -3.363874  0.203874
##sample estimates:
##  mean in group 1 mean in group 2 
##0.75            2.33 
</code></pre>

<p>t.test中paired=FALSE表示两独立样本检验,TRUE表示配对样本检验，var.equal=TRUE表示两样本方差一致。</p>

<p>结果：P值不显著，不能推翻原假设，因此可以认为两组总体均值无差异。</p>

<p><strong>3.两配对样本均值</strong></p>

<p><img src="https://taoshengxu.github.io/DocumentGit/img/twosample_test3.jpg" alt="" /></p>

<pre><code>t.test(extra ~ group,data = sleep2,paired=TRUE,var.equal=TRUE)
</code></pre>

<p>结果：P值显著，推翻原假设，服用两种安眠药后睡眠时间增加不同。</p>


  <footer>
  
<nav class="post-nav">
  <span class="nav-prev">&larr; <a href="/blog/cn/2017/10/logistic/">Logistic回归</a></span>
  <span class="nav-next"></span>
</nav>





<script src="//yihui.name/js/math-code.js"></script>
<script async src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>

<script async src="//yihui.name/js/center-img.js"></script>

  



<script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>



<script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/r.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/yaml.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/tex.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>



  
  <hr>
  <div class="copyright">&copy; <a href="xxxx">Who care</a> 2017 - Forever, maybe</div>
  
  </footer>
  </article>
  
  </body>
</html>

