<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>R Apply函数 - My Lives</title>
    <meta property="og:title" content="R Apply函数 - My Lives">
    

    
      
    

    

    
    

    <link rel="stylesheet" href="/blog/css/style.css" />
    <link rel="stylesheet" href="/blog/css/fonts.css" />
    <link rel="stylesheet" href="/blog/css/custom.css" />

  </head>

  
  <body class="blog">
    <header class="masthead">
      <h1><a href="/blog/">My Lives</a></h1>



      <nav class="menu">
        <input id="menu-check" type="checkbox" />
        <label id="menu-label" for="menu-check" class="unselectable">
          <span class="icon close-icon">✕</span>
          <span class="icon open-icon">☰</span>
          <span class="text">Menu</span>
        </label>
        <ul>
        
        
        <li><a href="/blog/">Home</a></li>
        
        <li><a href="/blog/en/">English</a></li>
        
        <li><a href="/blog/cn/">Chinese</a></li>
        
        <li><a href="/blog/paper/">Paper Reading</a></li>
        
        <li><a href="/blog/travel/">Travel</a></li>
        
        
        </ul>
      </nav>
    </header>

    <article class="main">
      <header class="title">
      
<h1>R Apply函数</h1>

<h3>
  2018-12-22</h3>
<hr>


      </header>



<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>

<tbody>
<tr>
<td>apply</td>
<td>Apply Functions Over ArrayMargins 对阵列行或者列使用函数</td>
<td>apply(X, MARGIN, FUN,&hellip;)</td>
</tr>

<tr>
<td>lapply</td>
<td>Apply a Function over a Listor Vector对列表或者向量使用函数</td>
<td>lapply(X, FUN,&hellip;)</td>
</tr>

<tr>
<td>sapply</td>
<td>Apply a Function over a Listor Vector对列表或者向量使用函数</td>
<td>sapply(X, FUN, &hellip;, simplify= TRUE, USE.NAMES = TRUE)</td>
</tr>

<tr>
<td>vapply</td>
<td>Apply a Function over a Listor Vector对列表或者向量使用函数</td>
<td>vapply(X, FUN, FUN.VALUE,&hellip;, USE.NAMES = TRUE)</td>
</tr>

<tr>
<td>tapply</td>
<td>Apply a Function Over aRagged Array对不规则阵列使用函数</td>
<td>tapply(X, INDEX, FUN = NULL,&hellip;, simplify = TRUE)</td>
</tr>

<tr>
<td>eapply</td>
<td>Apply a Function Over Valuesin an Environment对环境中的值使用函数</td>
<td>eapply(env, FUN, &hellip;,all.names = FALSE, USE.NAMES = TRUE)</td>
</tr>

<tr>
<td>mapply</td>
<td>Apply a Function to MultipleList or Vector Arguments对多个列表或者向量参数使用函数</td>
<td>mapply(FUN, &hellip;, MoreArgs =NULL, SIMPLIFY = TRUE, USE.NAMES = TRUE)</td>
</tr>

<tr>
<td>rapply</td>
<td>Recursively Apply a Functionto a List运用函数递归产生列表</td>
<td>rapply(object, f, classes =&ldquo;ANY&rdquo;, deflt = NULL,how = c(&ldquo;unlist&rdquo;, &ldquo;replace&rdquo;, &ldquo;list&rdquo;),&hellip;)</td>
</tr>
</tbody>
</table>

<ul>
<li>apply(X, MARGIN, FUN,&hellip;)
<em>X阵列，包括矩阵</em>
<em>MARGIN 1表示矩阵行，2表示矩阵列，也可以是c(1,2)</em></li>
<li>lapply(X, FUN, &hellip;)
X表示一个向量或者表达式对象，其余对象将被通过as.list强制转换为list</li>
<li>sapply(X, FUN, &hellip;, simplify= TRUE, USE.NAMES = TRUE)
X表示一个向量或者表达式对象，其余对象将被通过as.list强制转换为list
simplify逻辑值或者字符串，如果可以，结果应该被简化为向量、矩阵或者高维数组。必须是命名的，不能是简写。默认值是TRUE，若合适将会返回一个向量或者矩阵。如果simplify=”array”，结果将返回一个阵列。
USE.NAMES 逻辑值，如果为TRUE，且x没有被命名，则对x进行命名。这是一个用户友好版本，是lapply函数的包装版。该函数返回值为向量、矩阵，如果simplify=”array”，且合适的情况下，将会通过simplify2array()函数转换为阵列。sapply(x, f, simplify=FALSE,USE.NAMES=FALSE)返回的值与lapply(x,f)是一致的。</li>
</ul>

<p>举几个不是很常见但确实很有用的函数。</p>

<p>1、tapply()</p>

<p>tapply最常用于分组求和</p>

<p>df = data.frame(x1 = 1:15, x2 = c(rep(1, 1), rep(2, 2),</p>

<p>​        rep(3, 3), rep(4, 4), rep(5, 5)))</p>

<p>me = tapply(X = df$x1, INDEX = df$x2, FUN = mean); me</p>

<p>1    2    3    4    5</p>

<p>1.0  2.5  5.0  8.5 13.0</p>

<p>其实这里最强大的是FUN这个参数，因为函数完全可以自己写，比如：</p>

<p>su = tapply(X = df$x1, INDEX = df$x2, FUN = function(x){sum(x)}); su</p>

<p>1  2  3  4  5</p>

<p>1  5 15 34 65</p>

<p>2、sweep()</p>

<p>sweep函数用法有点类似apply，但是比apply更强大。</p>

<p>mat = matrix(1:25, ncol = 5, byrow = T)</p>

<p>sweep(mat, 1, 1:5, FUN = &ldquo;+&rdquo;)</p>

<p>​     [,1] [,2] [,3] [,4] [,5]</p>

<p>[1,]    2    3    4    5    6</p>

<p>[2,]    8    9   10   11   12</p>

<p>[3,]   14   15   16   17   18</p>

<p>[4,]   20   21   22   23   24</p>

<p>[5,]   26   27   28   29   30</p>

<p>sweep(mat, 2, 1:5, FUN = &ldquo;-&rdquo;)</p>

<p>​     [,1] [,2] [,3] [,4] [,5]</p>

<p>[1,]    0    0    0    0    0</p>

<p>[2,]    5    5    5    5    5</p>

<p>[3,]   10   10   10   10   10</p>

<p>[4,]   15   15   15   15   15</p>

<p>[5,]   20   20   20   20   20</p>

<p>同样的，这里函数可以自己定义。</p>

<p>3、coplot()</p>

<p>coplot这个协同图函数tiger的课程中有讲到过，简单的用法如下：</p>

<p>studata = read.table(&lsquo;exam3.7data.txt&rsquo;, header = TRUE); studata</p>

<p>学号    姓名 性别 年龄 身高  体重</p>

<p>1     1   Alice    F   13 56.5  84.0</p>

<p>2     2   Becka    F   13 65.3  98.0</p>

<p>3     3    Gail    F   14 64.3  90.0</p>

<p>4     4   Karen    F   12 56.3  77.0</p>

<p>5     5   Kathy    F   12 59.8  84.5</p>

<p>6     6    Mary    F   15 66.5 112.0</p>

<p>7     7   Sandy    F   11 51.3  50.5</p>

<p>8     8  Sharon    F   15 62.5 112.5</p>

<p>9     9   Tammy    F   14 62.8 102.5</p>

<p>10   10  Alfred    M   14 69.0 112.5</p>

<p>11   11    Duke    M   14 63.5 102.5</p>

<p>12   12   Guido    M   15 67.0 133.0</p>

<p>13   13   James    M   12 57.3  83.0</p>

<p>14   14 Jeffrey    M   13 62.5  84.0</p>

<p>15   15    John    M   12 59.0  99.5</p>

<p>16   16  Philip    M   16 72.0 150.0</p>

<p>17   17  Robert    M   12 64.8 128.0</p>

<p>18   18  Thomas    M   11 57.5  85.0</p>

<p>19   19 William    M   15 66.5 112.0</p>

<p>coplot(体重 ~ 身高 | 性别 + 年龄, data = studata)</p>

<p>其实运用R的技巧，这个函数能做的事情还有好多，比如：</p>

<p>panel.lm = function(x, y, &hellip;) {</p>

<p>tmp = lm(y ~ x)</p>

<p>abline(tmp, lwd = 2, col = 4)</p>

<p>points(x,y, &hellip;)}</p>

<p>coplot(体重 ~ 身高 | 性别 + 年龄, data = studata, panel = panel.lm, number = 3)</p>

<p>如果还有其他因素，这个函数还能显示更多：</p>

<p>studata$team = c(rep(2, 10), rep(3, 9))</p>

<p>coplot(体重 ~ 身高 | 性别 + 年龄, panel = panel.lm, cex = 1.5, pch = 19, number = 3,</p>

<p>​        col = studata$team, data = studata)</p>

<p>如果把学生按组或其他因素分开，也能用散点颜色进行区分。</p>

<p>如果还有成绩等因素，还能按成绩等级或者平均分进行划分。。。</p>


  <footer>
  
<nav class="post-nav">
  <span class="nav-prev">&larr; <a href="/blog/cn/2018/12/string_process/">R语言字符串处理汇总</a></span>
  <span class="nav-next"></span>
</nav>





<script src="//yihui.name/js/math-code.js"></script>
<script async src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>

<script async src="//yihui.name/js/center-img.js"></script>

  

  
  <hr>
  <div class="copyright">&copy; <a href="xxxx">Who care</a> 2017 - Forever, maybe</div>
  
  </footer>
  </article>
  
  </body>
</html>

